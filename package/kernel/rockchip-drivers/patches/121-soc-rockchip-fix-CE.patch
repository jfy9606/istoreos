From 79a10b75fdfefceaf7b4f2f5e0d425c5947c8bd8 Mon Sep 17 00:00:00 2001
From: jjm2473 <jjm2473@gmail.com>
Date: Wed, 10 Sep 2025 13:17:06 +0800
Subject: [PATCH] soc/rockchip: fix ce

---
 drivers/soc/rockchip/rockchip_opp_select.c     | 7 +++++++
 drivers/soc/rockchip/rockchip_system_monitor.c | 2 ++
 2 files changed, 9 insertions(+)

--- a/drivers/soc/rockchip/rockchip_opp_select.c
+++ b/drivers/soc/rockchip/rockchip_opp_select.c
@@ -2090,8 +2090,15 @@ static int rockchip_pvtpll_set_volt_sel(
 		return 0;
 
 	if (!info->pvtpll_smc)
+#if IS_REACHABLE(CONFIG_ROCKCHIP_CLK_PVTPLL)
 		return rockchip_pvtpll_volt_sel_adjust(info->pvtpll_clk_id,
 						       info->volt_sel);
+#else
+	{
+		WARN_ONCE(1, "CONFIG_ROCKCHIP_CLK_PVTPLL not enabled, should not going to here\n");
+		return 0;
+	}
+#endif
 
 	res = sip_smc_pvtpll_config(PVTPLL_VOLT_SEL, info->pvtpll_clk_id,
 				    (u32)info->volt_sel, 0, 0, 0, 0);
--- a/drivers/soc/rockchip/rockchip_system_monitor.c
+++ b/drivers/soc/rockchip/rockchip_system_monitor.c
@@ -1922,6 +1922,7 @@ static void system_monitor_early_min_vol
 static DECLARE_DELAYED_WORK(system_monitor_early_min_volt_work,
 			    system_monitor_early_min_volt_function);
 
+#if IS_ENABLED(CONFIG_CPU_RK3506)
 static int system_monitor_ddr_trefi_update(u32 ref_mode)
 {
 	struct arm_smccc_res res;
@@ -1942,6 +1943,7 @@ static __maybe_unused int rk3506_system_
 
 	return 0;
 }
+#endif
 
 static const struct of_device_id rockchip_system_monitor_of_match[] = {
 	{ .compatible = "rockchip,system-monitor", .data = NULL },
